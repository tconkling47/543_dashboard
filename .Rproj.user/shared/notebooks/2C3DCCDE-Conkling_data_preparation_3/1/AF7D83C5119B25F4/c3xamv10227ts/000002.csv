"0","flagships2 <- flagships%>%"
"0","  select(UNITID, INSTNM, UGDS, TUITIONFEE_IN, LONGITUDE, LATITUDE)"
"0","debt_pre_merge <- recent_cohort_field_of_study %>%"
"0","  filter(CREDLEV==3) %>%"
"0","  select(UNITID, INSTNM, CIPCODE, CIPDESC, CREDLEV, CREDDESC, DEBT_ALL_STGP_ANY_N, DEBT_ALL_STGP_ANY_MEAN)"
"0","data1 <- debt_pre_merge %>%"
"0","  filter(DEBT_ALL_STGP_ANY_N != 'PrivacySuppressed' "
"0","         & DEBT_ALL_STGP_ANY_MEAN != 'PrivacySuppressed')"
"0","data2 <- transform(data1, DEBT_ALL_STGP_ANY_N = as.numeric(DEBT_ALL_STGP_ANY_N),"
"0","                    DEBT_ALL_STGP_ANY_MEAN = as.numeric(DEBT_ALL_STGP_ANY_MEAN))"
"0","data3 <- data2 %>%"
"0","  mutate(total_debt = DEBT_ALL_STGP_ANY_N*DEBT_ALL_STGP_ANY_MEAN)"
"0","data4 <- data3 %>%"
"0","  group_by(UNITID) %>%"
"0","  summarise(total_students_in_school_sample = sum(DEBT_ALL_STGP_ANY_N),"
"0","            total_debt_in_school_sample = sum(total_debt)) %>%"
"0","  mutate(school_average_student_debt = total_debt_in_school_sample/total_students_in_school_sample)"
"0","flagships3 <- merge(data4, flagships2, by=""UNITID"")"
"0","flagships4 <- flagships3 %>%"
"0","  select(school_average_student_debt, INSTNM, UGDS, TUITIONFEE_IN, LONGITUDE, LATITUDE) %>%"
"0","  mutate(debt_category = case_when("
"0","    school_average_student_debt < 17000 ~ ""$14,000 - $17,000"","
"0","    school_average_student_debt < 20000 ~ ""$17,000 - $20,000"","
"0","    school_average_student_debt < 23000 ~ ""$20,000 - $23,000"","
"0","    school_average_student_debt <= 26000 ~ ""$23,000 - $26,000"","
"0","    school_average_student_debt > 26000 ~ ""$26,000 - $29,000"""
"0","  ))%>%"
"0","  mutate(Enrollment = case_when("
"0","    UGDS < 10000 ~ ""<10,000"","
"0","    UGDS < 20000 ~ ""10,000 - 20,000"","
"0","    UGDS < 30000 ~ ""20,000 - 30,000"","
"0","    UGDS <= 40000 ~ ""30,000 - 40,000"","
"0","    UGDS > 40000 ~ ""40,000 - 75,000"""
"0","  )) %>%"
"0","  mutate(UGDS2 = UGDS/10000) %>%"
"0","     mutate(tuition_category = case_when("
"0","    TUITIONFEE_IN < 9000 ~ ""$5,000 - $9,000"","
"0","    TUITIONFEE_IN < 13000 ~ ""$9,000 - $13,000"","
"0","    TUITIONFEE_IN <= 17000 ~ ""$13,000 - $17,000"","
"0","    TUITIONFEE_IN > 17000 ~ ""$17,000 - $20,000"""
"0","  ))"
"0","pointsC_1 <- plot_geo(flagships4, lat = ~LATITUDE, lon = ~LONGITUDE)"
"0","mak = list(sizeref=0.1, sizemode=""area"")"
"0","pointsC_1 <- pointsC_1 %>% add_markers("
"0","  text = ~paste(flagships4$INSTNM, ""<br />"", ""Undergraduates Enrolled:"", flagships4$UGDS, ""<br />"",  ""Average Student Debt After Graduation: $"", round(flagships4$school_average_student_debt,2)),"
"0","  color = ~flagships4$school_average_student_debt, colors = 'Oranges', marker = mak, size = flagships4$UGDS, hoverinfo = ""text"""
"0",")"
"0","pointsC_1 <- pointsC_1 %>%"
"0","  colorbar(title = ""Average Student Debt After Graduation"", y = 0.75)"
"2","Warning:"
"2"," `line.width` does not currently support multiple values.
"
"0","g <- list("
"0","  scope = 'usa',"
"0","  projection = list(type = 'albers usa'),"
"0","  showland = TRUE,"
"0","  landcolor = toRGB(""gray85""),"
"0","  subunitwidth = 1,"
"0","  countrywidth = 1,"
"0","  subunitcolor = toRGB(""white""),"
"0","  countrycolor = toRGB(""white"")"
"0",")"
"0","pointsC_1 <- pointsC_1 %>% layout(geo = g"
"0",")"
"0","legend.plot <- plot_ly() %>% "
"0","    add_markers(x = 1, "
"0","    y = seq_len(length(c(10000,20000,30000,40000,50000,60000,75000))),"
"0","    size = sort(c(10000,20000,30000,40000,50000,60000,75000)),"
"0","    showlegend = F, "
"0","    marker = mak, color = 'Enrollment') %>%"
"0","    layout("
"0","        annotations = list("
"0","            list(x = -0.05, "
"0","                y = 0.02, "
"0","                text = ""Number of Undergraduates Enrolled"","
"0","                showarrow = F, "
"0","                xref='paper', "
"0","                yref='paper')),"
"0","         xaxis = list("
"0","            zeroline=F,"
"0","            showline=F,"
"0","            showticklabels=F,"
"0","            showgrid=F),"
"0","         yaxis=list("
"0","            showgrid=F,"
"0","            tickmode = ""array"","
"0","            tickvals = seq_len(length(c(10000,20000,30000,40000,50000,60000,75000))),"
"0","            ticktext = c(""Less than 10,000"",""10,000 - 20,000"", ""20,000 - 30,000"", ""30,000 - 40,000"", ""40,000 - 50,000"", ""50,000 - 60,000"", ""60,000 - 75,000"")"
"0","            ))"
"0","pointsC_2 <- subplot(legend.plot, pointsC_1, widths = c(0.1, 0.9), "
"0","    titleX=TRUE, titleY=TRUE)"
"2","Warning:"
"2"," `line.width` does not currently support multiple values.
"
"2","Warning in RColorBrewer::brewer.pal(N, ""Set2"") :"
"2","
 "
"2"," minimal value for n is 3, returning requested palette with 3 different levels

"
"2","Warning in RColorBrewer::brewer.pal(N, ""Set2"") :"
"2","
 "
"2"," minimal value for n is 3, returning requested palette with 3 different levels

"
"0","pointsC_2 <- pointsC_2 %>%"
"0","  layout(title = list(text = 'Flagship Public Universities Enroll Large Student Populations With Relatively Low Student Debt Burdens After Graduation', y=0.97, x=0.5, font = list(family = ""Arial"", size = 20)))"
"0","#saving"
"0","saveRDS(pointsC_2,file = 'interactive_map.rds')"
